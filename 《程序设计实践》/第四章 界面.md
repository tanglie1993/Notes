在本章中，作者实现了一个可以读csv文件，并允许用户读取其中某一行或某一列的库。 

首先，作者实现了一个原型，这个原型具有最基本的功能，但在随后的过程中将被抛弃。如果这个程序是提供给别人用的，在原始设计中的这些仓促选择引起的麻烦就可能到许多年后才浮现出来。

接下来，作者构造了一个具有普遍使用价值的库。在此过程中，需要考虑的主要问题有：

- 信息隐藏。这个库应该对输入行长或域的个数没有限制。为了达到这个目的，或者是让调用程序为它提供存储，或者是被调用者 ( 库) 自己需要做分配。

- 资源管理。必须确定谁负责共享的信息。函数 c s v g e t l i n e是直接返回原始数据，还是做一个拷贝？

- 谁来打开和关闭文件？做文件打开的部分也应负责关闭：互相匹配的操作应该在同一个层次或位置完成。

- 在错误发生的时候，库函数绝不能简单地死掉，而是应该把错误状态返回给调用程序，以便那里能采取适当的措施。

- 如果 csvfield或 csvnfiled在csvgetline遇到EOF之后被调用，它们的返回值是什么？具有错误形式的域将如何处理？

C++实现：略。

###界面原则：

- 隐藏实现细节。对于程序的其他部分而言，界面后面的实现应该是隐藏的，这样才能使它的修改不影响或破坏别的东西。

- 应该避免全局变量。如果可能，最好是把所有需要引用的数据都通过函数参数传递给函数。

- 一般地说，窄的界面比宽的界面更受人欢迎，至少是在有了强有力的证据，说明确实需要给界面增加一些新功能之前。

- 不要在用户背后做小动作。一个库函数不应该写某个秘密文件、修改某个秘密变量，或者改变某些全局性数据，在改变其调用者的数据时也要特别谨慎。

- 一个界面在使用时不应该强求另外的东西，如果这样做仅仅是为了设计者或实现者的某些方便。

- 外部一致性，与其他东西的行为类似也是非常重要的。

- 在设计库( 或者类、包 ) 的界面时，一个最困难的问题就是管理某些资源，这些资源是库所拥有的，而又在库和它的调用程序之间共享。粗略地说，有关的问题大致涉及初始化、状态维护、共享和复制以及清除等等。

- 释放资源与分配资源应该在同一个层次进行。控制资源分配和回收有一种基本方式，那就是令完成资源分配的同一个库、程序包或界面也负责完成它的释放工作。

- 为了避免出问题，我们必须把代码写成可重入的，也就是说，无论存在多少个同时的执行，它都应该能正常工作。可重入代码要求避免使用全局变量、静态局部变量以及其他可能在别的线程里改变的变量。

- 作为一条具有普遍意义的规则，错误应该在尽可能低的层次上检测和发现，但应该在某个高一些的层次上处理。

- 如果能把各种各样的异常值 ( 如文件结束、可能的错误状态 )进一步区分开，而不是用单个返回值把它们堆在一起，那当然就更好了。

- 异常机制不应该用于处理可预期的返回值。读一个文件最终总要遇到文件结束，这个情况就应该以返回值的方式处理，而不是通过异常机制。

- 异常机制常常被人过度使用。由于异常是对控制流的一种旁路，它们可能使结构变得非常复杂，以至成为错误的根源。文件无法打开很难说是什么异常，在这种情况下产生一个异常有点过分。异常最好是保留给那些真正无法预期的事件，例如文件系统满或者浮点错误等等。

- 在发生错误时应该如何恢复有关的资源？如果发生了错误，库函数应该设法做这种恢复吗？通常它们不做这些事，但也可以在这方面提供一些帮助：提供尽可能清楚的信息和以尽可能无害的方式退出。

- 错误信息、提示符或对话框中的文本应该对合法输入给出说明。不要简单地说一个参数太大，而应说明参数值的合法范围。如果可能的话，给出的这段文本本身最好就是一段合法的输入，比如提供一个带合适参数的完整命令行。

- 从用户的观点看，风格问题，如简单性、清晰性、规范性、统一性、熟悉性和严谨性等，对于保证一个界面容易使用都是非常重要的，不具有这些性质的界面必定是令人讨厌的难对付的界面。